<%- include("header.ejs", {title:"Feed", logIn, user, img}) %>

        <section>
            
            <div class="posts">
                <% if (logIn){%>
                    <script>
                        

                        let textButtons = document.querySelectorAll(".txt-option");
                        // let advancedButtons = document.querySelectorAll(".adv-option-format");
                        let writingBox = document.getElementById("txt-input");
                        let linkButton = document.getElementById("createLink");
                        let imgButtton = document.getElementById("img");
                        let formatButtons = document.querySelectorAll(".format");
                        
                        const initializer = () =>{
                            //call de botoes clicados para destacar
                            highlighter(textButtons, true);
                            highlighter(advancedButtons, true);
                        }
                        
                        textButtons.forEach((button) => {
                            button.addEventListener("click", () => {
                                modifyText(button.id, false, null);
                            });
                        });
                        
                        const modifyText = (comando, defaultUi, valor) => {
                                document.execCommand(comando, defaultUi, valor);
                        };
                        
                        optionsButtons.forEach((button) => {
                            button.addEventListener("click", () => {
                                modifyText(button.id, false, null);
                            });
                        });
                        
                        //Destaca botões clicados
                        const highlighter = (className, Remover) => {
                            className.forEach((button) => {
                                button.addEventListener("click", () => {
                                //Remover = true, apenas um botão está destacado
                                if (Remover) {
                                    let ativo = false;
                        
                                    if (button.classList.contains("active")) {
                                    ativo = true;
                                    }
                                    
                                    //remove destaque dos outros botoes
                                    highlighterRemover(className);
                                    if (!ativo) {
                                    //destaque botao clicado
                                    button.classList.add("active");
                                    }
                                } 
                                else {
                                    //outros botoes podem ser clicados
                                    button.classList.toggle("active");
                                }
                                });
                            });
                        };
                        
                        const highlighterRemover = (className) => {
                            className.forEach((button) => {
                                button.classList.remove("active");
                            });
                        };
                        
                        window.onload = initializer();


                        function openPopup() {
                      let overlay = document.getElementById('overlay');
                      let popup  = document.getElementById('popup');
                      overlay.style.display = 'block';
                      popup.style.display = 'block';
                    }
                    
                    function cancelPopup() {
                      let overlay = document.getElementById('overlay');
                      let popup = document.getElementById('popup');
                      overlay.style.display = 'none';
                      popup.style.display = 'none';
                    }
                    
                    function sendData() {
                      let inputValue = document.getElementById('inputText').value;
                      console.log('Valor do input:', inputValue);
                      cancelPopup();
                    }
                    </script>


                    <button type="button"  onclick="openPopup()" id="criar-post" >Criar Publicação</button>
                        

                    <div id="overlay" class="overlay"></div>  
                    <div class="section" id="popup">
                        <form action="" method="post">

                            <div class="container">
                              <div class="post-container">
                                    <div class="post-box">
                                      <div class="post-settings">
                                        <button id="bold" class="txt-option format">
                                          <svg xmlns="http://www.w3.org/2000/svg" width="18" height="22" viewBox="0 0 18 22" fill="none">
                                            <path d="M15.4048 10.0586C16.1483 9.15031 16.607 8.04258 16.7231 6.87451C17.0835 3.14893 14.1602 0 10.5186 0H0.78125C0.57405 0 0.375336 0.08231 0.228823 0.228823C0.08231 0.375336 0 0.57405 0 0.78125V3.125C0 3.3322 0.08231 3.53091 0.228823 3.67743C0.375336 3.82394 0.57405 3.90625 0.78125 3.90625H2.3374V17.9688H0.78125C0.57405 17.9688 0.375336 18.0511 0.228823 18.1976C0.08231 18.3441 0 18.5428 0 18.75V21.0938C0 21.301 0.08231 21.4997 0.228823 21.6462C0.375336 21.7927 0.57405 21.875 0.78125 21.875H11.002C14.459 21.875 17.5518 19.3481 17.8867 15.8984C18.1182 13.5327 17.0864 11.4033 15.4048 10.0586ZM6.2334 3.90625H10.5186C11.1402 3.90625 11.7363 4.15318 12.1758 4.59272C12.6154 5.03226 12.8623 5.6284 12.8623 6.25C12.8623 6.8716 12.6154 7.46774 12.1758 7.90728C11.7363 8.34682 11.1402 8.59375 10.5186 8.59375H6.2334V3.90625ZM10.5186 17.9688H6.2334V12.5H10.5186C11.2438 12.5 11.9393 12.7881 12.452 13.3009C12.9648 13.8137 13.2529 14.5092 13.2529 15.2344C13.2529 15.9596 12.9648 16.6551 12.452 17.1679C11.9393 17.6807 11.2438 17.9688 10.5186 17.9688Z" fill="white"/>
                                          </svg>
                                        </button>
                                        <button id="italic" class="txt-option format">
                                          <svg xmlns="http://www.w3.org/2000/svg" width="25" height="25" viewBox="0 0 25 25" fill="none">
                                            <path d="M20.3125 2.34375V3.90625C20.3125 4.11345 20.2302 4.31216 20.0837 4.45868C19.9372 4.60519 19.7385 4.6875 19.5312 4.6875H16.4668L12.5605 20.3125H14.8438C15.051 20.3125 15.2497 20.3948 15.3962 20.5413C15.5427 20.6878 15.625 20.8865 15.625 21.0938V22.6562C15.625 22.8635 15.5427 23.0622 15.3962 23.2087C15.2497 23.3552 15.051 23.4375 14.8438 23.4375H5.46875C5.26155 23.4375 5.06284 23.3552 4.91632 23.2087C4.76981 23.0622 4.6875 22.8635 4.6875 22.6562V21.0938C4.6875 20.8865 4.76981 20.6878 4.91632 20.5413C5.06284 20.3948 5.26155 20.3125 5.46875 20.3125H8.5332L12.4395 4.6875H10.1562C9.94905 4.6875 9.75034 4.60519 9.60382 4.45868C9.45731 4.31216 9.375 4.11345 9.375 3.90625V2.34375C9.375 2.13655 9.45731 1.93784 9.60382 1.79132C9.75034 1.64481 9.94905 1.5625 10.1562 1.5625H19.5312C19.7385 1.5625 19.9372 1.64481 20.0837 1.79132C20.2302 1.93784 20.3125 2.13655 20.3125 2.34375Z" fill="white"/>
                                          </svg>
                                        </button>
                                            <button id="H" class="txt-option format">
                                              <svg xmlns="http://www.w3.org/2000/svg" width="24" height="22" viewBox="0 0 24 22" fill="none">
                                                <path d="M21.0938 3.125V18.75H22.6562C22.8635 18.75 23.0622 18.8323 23.2087 18.9788C23.3552 19.1253 23.4375 19.324 23.4375 19.5312V21.0938C23.4375 21.301 23.3552 21.4997 23.2087 21.6462C23.0622 21.7927 22.8635 21.875 22.6562 21.875H14.8438C14.6365 21.875 14.4378 21.7927 14.2913 21.6462C14.1448 21.4997 14.0625 21.301 14.0625 21.0938V19.5312C14.0625 19.324 14.1448 19.1253 14.2913 18.9788C14.4378 18.8323 14.6365 18.75 14.8438 18.75H16.4062V12.5H7.03125V18.75H8.59375C8.80095 18.75 8.99966 18.8323 9.14618 18.9788C9.29269 19.1253 9.375 19.324 9.375 19.5312V21.0938C9.375 21.301 9.29269 21.4997 9.14618 21.6462C8.99966 21.7927 8.80095 21.875 8.59375 21.875H0.78125C0.57405 21.875 0.375336 21.7927 0.228823 21.6462C0.08231 21.4997 0 21.301 0 21.0938V19.5312C0 19.324 0.08231 19.1253 0.228823 18.9788C0.375336 18.8323 0.57405 18.75 0.78125 18.75H2.34375V3.125H0.78125C0.57405 3.125 0.375336 3.04269 0.228823 2.89618C0.08231 2.74966 0 2.55095 0 2.34375V0.78125C0 0.57405 0.08231 0.375336 0.228823 0.228823C0.375336 0.08231 0.57405 0 0.78125 0H8.59375C8.80095 0 8.99966 0.08231 9.14618 0.228823C9.29269 0.375336 9.375 0.57405 9.375 0.78125V2.34375C9.375 2.55095 9.29269 2.74966 9.14618 2.89618C8.99966 3.04269 8.80095 3.125 8.59375 3.125H7.03125V9.375H16.4062V3.125H14.8438C14.6365 3.125 14.4378 3.04269 14.2913 2.89618C14.1448 2.74966 14.0625 2.55095 14.0625 2.34375V0.78125C14.0625 0.57405 14.1448 0.375336 14.2913 0.228823C14.4378 0.08231 14.6365 0 14.8438 0H22.6562C22.8635 0 23.0622 0.08231 23.2087 0.228823C23.3552 0.375336 23.4375 0.57405 23.4375 0.78125V2.34375C23.4375 2.55095 23.3552 2.74966 23.2087 2.89618C23.0622 3.04269 22.8635 3.125 22.6562 3.125H21.0938Z" fill="white"/>
                                              </svg>
                                            </button>
                                            <button id="createLink" class="adv-option-button">
                                              <svg xmlns="http://www.w3.org/2000/svg" width="25" height="25" viewBox="0 0 25 25" fill="none">
                                                <g clip-path="url(#clip0_250_432)">
                                                  <path d="M15.9478 9.05232C18.8652 11.9727 18.8251 16.6548 15.9654 19.5303C15.9601 19.5362 15.9537 19.5426 15.9478 19.5484L12.6666 22.8297C9.77255 25.7237 5.06411 25.7233 2.1705 22.8297C-0.723541 19.9361 -0.723541 15.2271 2.1705 12.3336L3.98232 10.5218C4.46279 10.0413 5.29023 10.3606 5.31503 11.0396C5.34667 11.905 5.50185 12.7743 5.78818 13.6139C5.88515 13.8982 5.81586 14.2126 5.60346 14.425L4.96445 15.064C3.59599 16.4325 3.55307 18.6607 4.90805 20.0426C6.27641 21.438 8.52553 21.4463 9.90439 20.0675L13.1856 16.7867C14.5622 15.4102 14.5564 13.1853 13.1856 11.8145C13.0049 11.6342 12.8229 11.494 12.6807 11.3961C12.5801 11.327 12.4971 11.2354 12.4382 11.1285C12.3793 11.0217 12.3462 10.9025 12.3415 10.7806C12.3222 10.2646 12.505 9.73293 12.9127 9.32522L13.9407 8.29714C14.2103 8.02756 14.6332 7.99446 14.9458 8.21262C15.3038 8.4626 15.6391 8.74358 15.9478 9.05232ZM22.8294 2.17039C19.9358 -0.723267 15.2274 -0.723657 12.3333 2.17039L9.05209 5.45164C9.04623 5.4575 9.03989 5.46384 9.03452 5.4697C6.17485 8.34529 6.13476 13.0274 9.05209 15.9477C9.36082 16.2565 9.69612 16.5374 10.0541 16.7874C10.3667 17.0055 10.7896 16.9724 11.0592 16.7029L12.0872 15.6748C12.4949 15.2671 12.6777 14.7354 12.6584 14.2194C12.6537 14.0975 12.6206 13.9783 12.5617 13.8715C12.5028 13.7646 12.4198 13.673 12.3192 13.6039C12.177 13.506 11.995 13.3658 11.8143 13.1855C10.4435 11.8147 10.4377 9.58982 11.8143 8.21331L15.0955 4.93254C16.4744 3.55369 18.7234 3.56199 20.0918 4.95745C21.4468 6.33928 21.4039 8.56751 20.0354 9.93596L19.3964 10.575C19.184 10.7874 19.1147 11.1018 19.2117 11.3861C19.498 12.2257 19.6532 13.095 19.6849 13.9604C19.7097 14.6394 20.5371 14.9587 21.0176 14.4782L22.8294 12.6664C25.7235 9.77292 25.7235 5.06394 22.8294 2.17039Z" fill="white"/>
                                                </g>
                                                <defs>
                                                  <clipPath id="clip0_250_432">
                                                    <rect width="25" height="25" fill="white"/>
                                                  </clipPath>
                                                </defs>
                                              </svg>
                                            </button>
                                            <button id="img" class="adv-option-button">
                                              <svg xmlns="http://www.w3.org/2000/svg" width="25" height="19" viewBox="0 0 25 19" fill="none">
                                                <path d="M22.6562 18.75H2.34375C1.04932 18.75 0 17.7007 0 16.4062V2.34375C0 1.04932 1.04932 0 2.34375 0H22.6562C23.9507 0 25 1.04932 25 2.34375V16.4062C25 17.7007 23.9507 18.75 22.6562 18.75ZM5.46875 2.73438C3.95859 2.73438 2.73438 3.95859 2.73438 5.46875C2.73438 6.97891 3.95859 8.20312 5.46875 8.20312C6.97891 8.20312 8.20312 6.97891 8.20312 5.46875C8.20312 3.95859 6.97891 2.73438 5.46875 2.73438ZM3.125 15.625H21.875V10.1562L17.6018 5.88306C17.373 5.65425 17.002 5.65425 16.7731 5.88306L10.1562 12.5L7.44556 9.78931C7.21675 9.5605 6.84575 9.5605 6.61689 9.78931L3.125 13.2812V15.625Z" fill="white"/>
                                              </svg>
                                            </button>
                                            <button id="question-mark" class="adv-option-button">
                                              <svg xmlns="http://www.w3.org/2000/svg" width="25" height="25" viewBox="0 0 25 25" fill="none">
                                                <g clip-path="url(#clip0_250_434)">
                                                  <path d="M24.6094 12.5C24.6094 19.1893 19.1874 24.6094 12.5 24.6094C5.81265 24.6094 0.390625 19.1893 0.390625 12.5C0.390625 5.8146 5.81265 0.390625 12.5 0.390625C19.1874 0.390625 24.6094 5.8146 24.6094 12.5ZM12.825 4.39453C10.164 4.39453 8.4668 5.51548 7.13408 7.50771C6.96143 7.76582 7.01919 8.11392 7.26665 8.30156L8.96094 9.58623C9.21509 9.77896 9.5772 9.73311 9.77466 9.48262C10.6469 8.37627 11.245 7.73472 12.5727 7.73472C13.5702 7.73472 14.804 8.37671 14.804 9.34399C14.804 10.0752 14.2003 10.4508 13.2154 11.003C12.0668 11.6469 10.5469 12.4483 10.5469 14.4531V14.6484C10.5469 14.972 10.8092 15.2344 11.1328 15.2344H13.8672C14.1908 15.2344 14.4531 14.972 14.4531 14.6484V14.5833C14.4531 13.1936 18.5149 13.1357 18.5149 9.375C18.5149 6.54287 15.5772 4.39453 12.825 4.39453ZM12.5 16.5039C11.2615 16.5039 10.2539 17.5115 10.2539 18.75C10.2539 19.9885 11.2615 20.9961 12.5 20.9961C13.7385 20.9961 14.7461 19.9885 14.7461 18.75C14.7461 17.5115 13.7385 16.5039 12.5 16.5039Z" fill="white"/>
                                                </g>
                                                <defs>
                                                  <clipPath id="clip0_250_434">
                                                    <rect width="25" height="25" fill="white"/>
                                                  </clipPath>
                                                </defs>
                                              </svg>
                                            </button>
                                          </div>
                                          <div id="txt-input" contenteditable="true">
                                            <input type="text" name="conteudo" id="conteudo-postagem">
                                          </div>
                                        
                                        </div>
                                        <button type="button" id="cancel-btn" onclick="cancelPopup()">Cancelar</button>
                                        <button type="submit" id="post-btn" onclick="sendData()">Postar</button>
                                      </div>
                                    </div>
                                  </form>
                    </div>
                                        
                <%}%>

                <% posts.reverse().forEach((post)=>{ %>
                <div class="post">
                    <div id="post-user-infos">
                      <div id="post-user-personal-infos">

                        <img id="img-post" src="data:image/jpeg;base64, <%=post.user.userImg%>" alt="">
                        <a href="/perfil/<%=post.user.id%>" id="link-name">
                          <p id="post-owner"><%= post.user.username%></p>
                          
                        </a>
                        <% const meses = ["jan", "fev", "mar", "abr","mai", "jun", "jul", "ago","set", "out", "nov", "dez"]; %>
                        <p id="created-at">· <%= post.created_at.getDate() %> de <%= meses[post.created_at.getMonth()] %></p>
                      </div>


                        <div id="trash">
                          <%if (logIn && user.admin){%>
                            <form action="/deletar-post" method="POST">
                              <input type="hidden" name="post_id" value="<%= post.id%>">
                              <button id="deletePost" type="submit" class="trash">
                                <img src="../imagens/trash.png" alt="">
                              </button>
                            </form>
                          <%}%>
                        </div>
                    </div>
                    <div id="post-content">
                        <p>
                            <%=post.content%>
                        </p>  
                    </div>
                    <a href="/comentarios/<%=post.id%>">
                        <img id="comment-img" src="../imagens/comment.png" alt="">
                    </a>
                </div>
                <%})%>
            </div>
        </section>
    </body>
</html>
